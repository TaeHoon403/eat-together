<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="Party">
<<<<<<< HEAD
<select resultType="int" id="getNextval">
select party_seq.nextval from dual 
</select>
<insert id="insert">
   insert into party values (#{seq},#{parent_name}, #{parent_address}, #{title}, #{writer}, #{meetdate}, #{count}, #{gender}, #{age}, #{drinking}, #{content},#{status},#{place_id},'aa')
</insert>
=======
>>>>>>> e073781d490e66f4382e86811a8fdcdba18faa31

	<select resultType="int" id="getNextval">
		select party_seq.nextval from dual
	</select>
	<insert id="insert">
		insert into party values (#{seq},#{parent_name},
		#{parent_address},
		#{title}, #{writer}, #{meetdate}, #{count},
		#{gender}, #{age},
		#{drinking}, #{content},#{status},#{place_id},
		#{imgaddr})
	</insert>


<<<<<<< HEAD
<update id="update">
      update party set parent_name = #{parent_name}, parent_address = #{parent_address}, title = #{title}, meetdate = #{meetdate}, count=#{count}, gender=#{gender},age=#{age},drinking=#{drinking},content=#{content},place_id=#{place_id} where seq=#{seq}
 </update>
 <select id="selectByPlace_id" resultType="coma.spring.dto.PartyDTO">
       select * from party where place_id = #{place_id}
 </select>
   <select id="getArticleCount" resultType="int">
      select count(*) from party where place_id = #{place_id}
   </select>
   <select id="selectByPageNo" resultType="coma.spring.dto.PartyDTO">
      select * from (select party.*, row_number() over(order by seq desc) as rnum from party where place_id = #{place_id}) where rnum between #{start} and #{end}
   </select>
   
   <update id="stopRecruit">
   		update party set status = 0 where seq = #{value}
   </update>
 
 <select id="selectList" resultType="coma.spring.dto.PartyDTO">
	<!-- select * from party where status = 1 order by seq desc -->
	select * from (select party.*, row_number() over(order by seq desc) as rnum from party where status=1) where rnum between #{start} and #{end}
</select>

<select id="partySearch" resultType="coma.spring.dto.PartyDTO">
	select * from (select * from party where status =1)
	<trim prefixOverrides="or" prefix="where">
		<if test="address != ''">parent_address like '%${address}%'</if>
		<if test="gender != null">or gender =  '${gender}'</if>
		<if test="ageList.size != 0">or age like
			<foreach collection="ageList" item="aa" open="" close="" separator="or age like">
				'%${aa}%'
			</foreach>
		</if>
		<if test="drinking != 2">or drinking = ${drinking}</if>
		<if test="title != ''">or title like '%${title}%'</if>
		<if test="writer != ''">or writer like '%${writer}%'</if>
		<if test="content != ''">or content like '%${content}%'</if>
		<if test="both != ''">or title like '%${both}%' or content like '%${both}%'</if>
	</trim>
	  order by seq desc
</select>

<select id="getListCount" resultType="int">
      select count(*) from party where status =1
</select>

<select id="PartyCountById" resultType="String">
      select place_id from party group by place_id order by count(*) desc
</select>

<!--  
<update id="update">
      update board set ${columnName1} = #{changeValue1}, ${columnName2} = #{changeValue2} where ${targetColumn} = #{targetValue}
 </update> 
 -->
=======
	<select id="selectBySeq" resultType="coma.spring.dto.PartyDTO">
		select * from party where
		seq = #{value} order by seq desc
	</select>

	<!-- by 지은, 내 모임 마이페이지 리스트 출력을 위한 select문 생성_20200707 -->
>>>>>>> e073781d490e66f4382e86811a8fdcdba18faa31

	<select id="selectByWriterPage"
		resultType="coma.spring.dto.PartyDTO">
		select * from (select party.*, row_number() over(order by
		seq desc) rnum from party where writer=#{writer}) where rnum between
		#{start} and #{end}
	</select>

	<select id="getMyPageArticleCount" resultType="int">
		select count(*)
		from party where writer = #{value}
	</select>

	<!-- by 지은, 내 모임 마이페이지 리스트 출력을 위한 select문 생성_20200707 -->

	<delete id="delete">
		delete from party where seq = #{value}
	</delete>

	<update id="update">
		update party set parent_name = #{parent_name},
		parent_address =
		#{parent_address}, title = #{title}, meetdate =
		#{meetdate},
		count=#{count},
		gender=#{gender},age=#{age},drinking=#{drinking},content=#{content},place_id=#{place_id}
		where seq=#{seq}
	</update>
	<select id="selectByPlace_id"
		resultType="coma.spring.dto.PartyDTO">
		select * from party where place_id = #{place_id}
	</select>
	<select id="getArticleCount" resultType="int">
		select count(*) from
		party where place_id = #{place_id}
	</select>
	<select id="selectByPageNo"
		resultType="coma.spring.dto.PartyDTO">
		select * from (select party.*, row_number() over(order by
		seq desc) as rnum
		from party where place_id = #{place_id}) where rnum
		between #{start}
		and #{end}
	</select>

	<update id="stopRecruit">
		update party set status = 0 where seq = #{value}
	</update>

	<select id="selectList" resultType="coma.spring.dto.PartyDTO">
		select * from party where
		status=1 and seq not in (11,9) order by seq desc
	</select>

	<select id="partySearch" resultType="coma.spring.dto.PartyDTO">
		select * from party
		<trim prefixOverrides="or"
			prefix="where status=1 and seq not in (11,9) and (">
			<if test="address != ''">parent_address like '%${address}%'</if>
			<if test="gender != null">or gender = '${gender}'</if>
			<if test="ageList.size != 0">
				or age like
				<foreach collection="ageList" item="aa" open="" close=""
					separator="or age like">
					'%${aa}%'
				</foreach>
			</if>
			<if test="drinking != 2">or drinking = ${drinking}</if>
			<if test="title != ''">or title like '%${title}%'</if>
			<if test="writer != ''">or writer like '%${writer}%'</if>
			<if test="content != ''">or content like '%${content}%'</if>
			<if test="both != ''">or title like '%${both}%' or content like '%${both}%'
			</if>
		</trim>
		) order by seq desc
	</select>

	<!-- <update id="update"> update board set ${columnName1} = #{changeValue1}, 
		${columnName2} = #{changeValue2} where ${targetColumn} = #{targetValue} </update> -->
	<select id="selectAllCount" resultType="int">
		select count(*) from
		party
	</select>
</mapper>